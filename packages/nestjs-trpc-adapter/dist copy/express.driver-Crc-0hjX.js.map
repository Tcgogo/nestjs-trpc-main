{"version":3,"file":"express.driver-Crc-0hjX.js","names":["import_objectSpread2","ExpressDriver","options: TRPCModuleOptions","app: ExpressApplication","appRouter: AnyRouter","contextInstance: TRPCContext | null"],"sources":["../../../node_modules/.pnpm/@trpc+server@11.4.3_typescript@5.8.3/node_modules/@trpc/server/dist/adapters/express.mjs","../lib/drivers/express.driver.ts"],"sourcesContent":["import { __toESM, require_objectSpread2 } from \"../getErrorShape-Uhlrl4Bk.mjs\";\nimport \"../tracked-gU3ttYjg.mjs\";\nimport { run } from \"../utils-DdbbrDku.mjs\";\nimport \"../parseTRPCMessage-ByIHyFRz.mjs\";\nimport \"../resolveResponse-CzlbRpCI.mjs\";\nimport \"../contentTypeParsers-SN4WL9ze.mjs\";\nimport \"../unstable-core-do-not-import-D89CaGtL.mjs\";\nimport \"../observable-UMO3vUa_.mjs\";\nimport \"../initTRPC-IT_6ZYJd.mjs\";\nimport { internal_exceptionHandler, nodeHTTPRequestHandler } from \"../node-http-ZvZKxPic.mjs\";\n\n//#region src/adapters/express.ts\nvar import_objectSpread2 = __toESM(require_objectSpread2(), 1);\nfunction createExpressMiddleware(opts) {\n\treturn (req, res) => {\n\t\tlet path = \"\";\n\t\trun(async () => {\n\t\t\tpath = req.path.slice(req.path.lastIndexOf(\"/\") + 1);\n\t\t\tawait nodeHTTPRequestHandler((0, import_objectSpread2.default)((0, import_objectSpread2.default)({}, opts), {}, {\n\t\t\t\treq,\n\t\t\t\tres,\n\t\t\t\tpath\n\t\t\t}));\n\t\t}).catch(internal_exceptionHandler((0, import_objectSpread2.default)({\n\t\t\treq,\n\t\t\tres,\n\t\t\tpath\n\t\t}, opts)));\n\t};\n}\n\n//#endregion\nexport { createExpressMiddleware };\n//# sourceMappingURL=express.mjs.map","import { Injectable } from '@nestjs/common';\nimport type { Application as ExpressApplication } from 'express';\nimport type { TRPCContext, TRPCModuleOptions } from '../interfaces';\nimport type { AnyRouter } from '@trpc/server';\nimport * as trpcExpress from '@trpc/server/adapters/express';\n\n@Injectable()\nexport class ExpressDriver<\n  TOptions extends Record<string, any> = TRPCModuleOptions,\n> {\n  public async start(\n    options: TRPCModuleOptions,\n    app: ExpressApplication,\n    appRouter: AnyRouter,\n    contextInstance: TRPCContext | null,\n  ) {\n    app.use(\n      options.basePath ?? '/trpc',\n      trpcExpress.createExpressMiddleware({\n        router: appRouter,\n        ...(options.context != null && contextInstance != null\n          ? {\n              createContext: (opts) => contextInstance.create(opts),\n            }\n          : {}),\n      }),\n    );\n  }\n}\n"],"x_google_ignoreList":[0],"mappings":";;;;;;;;AAYA,IAAIA,yBAAuB,UAAQ,yBAAuB,EAAE,EAAE;AAC9D,SAAS,wBAAwB,MAAM;AACtC,QAAO,SAAC,KAAK,KAAQ;EACpB,IAAI,OAAO;AACX,0DAAgB;AACf,UAAO,IAAI,KAAK,MAAM,IAAI,KAAK,YAAY,IAAI,GAAG,EAAE;AACpD,SAAM,uBAAuB,CAAC,GAAGA,uBAAqB,SAAS,CAAC,GAAGA,uBAAqB,SAAS,CAAE,GAAE,KAAK,EAAE,CAAE,GAAE;IAC/G;IACA;IACA;GACA,EAAC,CAAC;EACH,GAAC,CAAC,MAAM,0BAA0B,CAAC,GAAGA,uBAAqB,SAAS;GACpE;GACA;GACA;EACA,GAAE,KAAK,CAAC,CAAC;CACV;AACD;;;;;;;;ACtBM,0BAAMC,gBAEX;CACA,AAAa,MACXC,SACAC,KACAC,WACAC;2DACA;;AACA,OAAI,yBACF,QAAQ,yEAAY,SACpB,4DACE,QAAQ,aACJ,QAAQ,WAAW,QAAQ,mBAAmB,OAC9C,EACE,eAAe,SAAC,MAAS;2BAAgB,OAAO,KAAK;KACtD,IACD,CAAE,GACN,CACH;EACF;;AACF;8CAtBA,+BAAY"}